@using Microsoft.Extensions.FileProviders
@model WebApplication.IndexModel



@{
    Layout = "~/Pages/_Layout.cshtml";
}

@{
    ViewBag.Title = "Download";
}

<h1>Sound Files Downloader</h1><br />


<form method="post" enctype="multipart/form-data" action="/Download">

    <div class="form-group">
        <label for="ddl">Device</label>
        @Html.DropDownList("ddl", Model.Devices.Select(item => new SelectListItem
        {
            Value = item.Name.ToString(),
            Text = item.Name.ToString(),
            Selected = item.Name == Model.selected

        }), new { onchange = "this.form.submit();" })
    </div>
    <div class="form-group">
        <label id="ReportBeginDate">Report Begin Date</label>
        <input type="date" name="start" value="@if (Model.start != null) {@Model.start_d.ToString("yyyy-MM-dd"); }else{@DateTime.Today.ToString("yyyy-MM-dd");}" />
    </div>

    <div class="form-group">
        <label id="ReportEndDate">Report End Date</label>
        <input type="date" name="end" value="@if (Model.end != null) {@Model.end_d.ToString("yyyy-MM-dd"); }else{@DateTime.Today.ToString("yyyy-MM-dd");}" />
    </div>

    <button type="submit">Search</button>
</form>


<form method="post" enctype="multipart/form-data" action="/Download/DownloadFiles">

    <table class="table">

        <tr>
            <th>Name File</th>
            <th>Date Created</th>
        </tr>


        @foreach (var item in Model.Files)
    {
        
        <tr>
            @if (Model.start != null && Model.end != null)
    {

        @if (Model.start_d.CompareTo(item.LastModified.Date) <= 0 && Model.end_d.CompareTo(item.LastModified.Date) >= 0 && (item.Name.ToString().Substring(item.Name.ToString().IndexOf('.'), 5) == ".flac") && item.Name.ToString().Length == 18)
{
        <td>
            @Html.ActionLink(@item.Name, "DownloadUniqueFile", "Download", new { namefile = @item.Name }, new { device = @Model.selected.ToString() })
        </td>
        
        <td>
            @item.LastModified.AddHours(-5).ToString()
        </td>
}

}
else
{
        <td>
            @Html.ActionLink(@item.Name, "DownloadUniqueFile", "Download", new { namefile = @item.Name }, new { device = @Model.selected.ToString() })
        </td>

}

        </tr>

}







    </table>

    <input type="hidden" name="start" value="@if (Model.start != null) {@Model.start_d.ToString("yyyy-MM-dd"); }" />
    <input type="hidden" name="end" value="@if (Model.end != null) {@Model.end_d.ToString("yyyy-MM-dd"); }" />
    <input id="ddt" name="device" type="hidden" value="@Model.selected" />
    <button type="submit">Download All Files</button>
</form>
